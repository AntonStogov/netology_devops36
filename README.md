# Домашнее задание к занятию «Управляющие конструкции в коде Terraform»
---
## Задание 1
---
1. Изучите проект.
2. Заполните файл personal.auto.tfvars.
3. Инициализируйте проект, выполните код. Он выполнится, даже если доступа к preview нет.
---
### Ответ:
Я изучил проект и заполнили файл personal.auto.tfvars необходимыми значениями (например, token, cloud_id, folder_id).
Инициализировал проект с помощью команды terraform init, которая подготовила все необходимые зависимости. Применил конфигурацию с помощью команды terraform apply,
что привело к созданию необходимых ресурсов, включая сеть и группу безопасности в Yandex Cloud. 

[Скриншот 1](https://github.com/user-attachments/assets/7ea137e2-53d1-4f4c-b407-840557f0cab6)
---
## Задание 2
---
1. Создайте файл count-vm.tf. Опишите в нём создание двух одинаковых ВМ web-1 и web-2 (не web-0 и web-1) с минимальными параметрами, используя мета-аргумент count loop. Назначьте ВМ созданную в первом задании группу безопасности.(как это сделать узнайте в документации провайдера yandex/compute_instance )

2. Создайте файл for_each-vm.tf. Опишите в нём создание двух ВМ для баз данных с именами "main" и "replica" разных по cpu/ram/disk_volume , используя мета-аргумент for_each loop. Используйте для обеих ВМ одну общую переменную типа:

`variable "each_vm" {
  type = list(object({  vm_name=string, cpu=number, ram=number, disk_volume=number }))
}`

3. При желании внесите в переменную все возможные параметры. 4. ВМ из пункта 2.1 должны создаваться после создания ВМ из пункта 2.2. 5. Используйте функцию file в local-переменной для считывания ключа ~/.ssh/id_rsa.pub и его последующего использования в блоке metadata, взятому из ДЗ 2. 6. Инициализируйте проект, выполните код.

### Ответ

Создал файл count-vm.tf, где описал создание двух одинаковых виртуальных машин web-1 и web-2 с использованием мета-аргумента count.
Создал файл for_each-vm.tf, где описал создание двух ВМ для баз данных с именами main и replica, которые отличались по параметрам cpu, ram, и disk_volume, используя мета-аргумент for_each.
Назначил созданной ранее группе безопасности эти виртуальные машины.

---
## Задание 3
---
1. Создайте 3 одинаковых виртуальных диска размером 1 Гб с помощью ресурса yandex_compute_disk и мета-аргумента count в файле disk_vm.tf .

2. Создайте в том же файле одиночную(использовать count или for_each запрещено из-за задания №4) ВМ c именем "storage" . Используйте блок dynamic secondary_disk{..} и мета-аргумент for_each для подключения созданных вами дополнительных дисков.

### Ответ

В файле disk_vm.tf создал три одинаковых виртуальных диска размером 1 ГБ с помощью ресурса yandex_compute_disk и мета-аргумента count.
Создал виртуальную машину storage, к которой подключил эти три диска с использованием блока dynamic secondary_disk и мета-аргумента for_each.

---
## Задание 4
---

1. В файле ansible.tf создайте inventory-файл для ansible. Используйте функцию tepmplatefile и файл-шаблон для создания ansible inventory-файла из лекции. Готовый код возьмите из демонстрации к лекции demonstration2. Передайте в него в качестве переменных группы виртуальных машин из задания 2.1, 2.2 и 3.2, т. е. 5 ВМ.

2. Инвентарь должен содержать 3 группы и быть динамическим, т. е. обработать как группу из 2-х ВМ, так и 999 ВМ.

3. Добавьте в инвентарь переменную fqdn.

`[webservers]
web-1 ansible_host=<внешний ip-адрес> fqdn=<полное доменное имя виртуальной машины>
web-2 ansible_host=<внешний ip-адрес> fqdn=<полное доменное имя виртуальной машины>

[databases]
main ansible_host=<внешний ip-адрес> fqdn=<полное доменное имя виртуальной машины>
replica ansible_host<внешний ip-адрес> fqdn=<полное доменное имя виртуальной машины>

[storage]
storage ansible_host=<внешний ip-адрес> fqdn=<полное доменное имя виртуальной машины>`

Пример fqdn: web1.ru-central1.internal(в случае указания переменной hostname(не путать с переменной name)); 
fhm8k1oojmm5lie8i22a.auto.internal(в случае отсутвия перменной hostname - автоматическая генерация имени, зона изменяется на auto). 
нужную вам переменную найдите в документации провайдера или terraform console. 

4. Выполните код. Приложите скриншот получившегося файла.

### Ответ

Создал файл ansible.tf, где с помощью функции templatefile и шаблона inventory.tpl сгенерировал Ansible inventory файл (inventory.ini).
Inventory файл был создан с динамическими группами для web, db, и storage виртуальных машин, включая их IP-адреса и FQDN.
Inventory файл был сохранен в корне проекта и может быть использован для дальнейшего управления виртуальными машинами с помощью Ansible.
Создал новую ветку terraform-03 в моем GitHub репозитории и загрузил туда все изменения, связанные с выполнением этих заданий.
Убедился, что все ненужные файлы были удалены, а финальный код успешно загружен на GitHub.

[Скриншот 2](https://github.com/user-attachments/assets/562be978-ed67-4ab6-b8aa-8589a67bfba2)




